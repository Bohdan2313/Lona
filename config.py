# config.py

import os
from dotenv import load_dotenv
from pybit.unified_trading import HTTP

# ============================ üîê –ö–õ–Æ–ß–Ü/–ö–õ–Ü–Ñ–ù–¢ ============================
load_dotenv()
BYBIT_API_KEY = os.getenv("BYBIT_API_KEY")
BYBIT_API_SECRET = os.getenv("BYBIT_API_SECRET")

EXCHANGE = "bybit"
bybit = HTTP(api_key=BYBIT_API_KEY, api_secret=BYBIT_API_SECRET)
client = bybit  # —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π –ø—Å–µ–≤–¥–æ–Ω—ñ–º

# ============================ üßπ –§–Ü–õ–¨–¢–†–ò/–ó–ê–ì–ê–õ–¨–ù–ï ============================
SKIP_1000_TOKENS = True
ACTIVE_TRADES_FILE = "data/active_trades.json"
ENABLE_LOGGING = True
TRADING_CYCLE_PAUSE = 60          # —Å–µ–∫ –º—ñ–∂ —Ü–∏–∫–ª–∞–º–∏
MAX_ACTIVE_TRADES = 10
DRY_RUN = False

# ============================ üìà –ê–ù–ê–õ–Ü–¢–ò–ö–ê ============================
VOLUME_THRESHOLDS = {
    "very_high_ratio": 1.8,
    "high_ratio": 1.1,
    "very_low_ratio": 0.15,
    "low_ratio": 0.5,
    "min_bybit_volume": {
        "low": 50_000,
        "normal": 200_000,
        "high": 500_000
    }
}

# ============================ üí∞ –ú–ê–ù–£–ê–õ–¨–ù–Ü –ü–ê–†–ê–ú–ï–¢–†–ò ============================
# –Ø–∫—â–æ —Ö–æ—á–µ—à –∑–∞–≤–∂–¥–∏ —Å—Ç–∞—Ä—Ç—É–≤–∞—Ç–∏ $100 —ñ –ø–ª–µ—á–µ 5√ó ‚Äî —Ç—Ä–∏–º–∞–π True —ñ —Ü—ñ –∑–Ω–∞—á–µ–Ω–Ω—è
USE_MANUAL_BALANCE = True
MANUAL_BALANCE = 6.0  # $ —Å—Ç–∞—Ä—Ç –Ω–∞ —É–≥–æ–¥—É (–º–∞—Ä–∂–∞ –ø–µ—Ä—à–æ—ó —Å—Ö–æ–¥–∏–Ω–∫–∏)

USE_MANUAL_LEVERAGE = True
MANUAL_LEVERAGE = 5     # –±–∞–∑–æ–≤–µ –ø–ª–µ—á–µ (—É–∑–≥–æ–¥–∂–µ–Ω–µ –∑—ñ SMART_AVG)

USE_EXCHANGE_TP = False

TP_USE_IOC = True  # —è–∫—â–æ True ‚Üí TP –æ—Ä–¥–µ—Ä –±—É–¥–µ IOC (–º–∏—Ç—Ç—î–≤–∏–π), –∞ –Ω–µ PostOnly

TP_EPSILON       = 0.0007 # 0.07% –º'—è–∫–∏–π –¥–æ–ø—É—Å–∫ –¥–ª—è —Å–æ—Ñ—Ç TP —É manage_open_trade
# (TP_USE_IOC –º–æ–∂–µ—à –∑–∞–ª–∏—à–∏—Ç–∏, –∞–ª–µ –≤—ñ–Ω —ñ–≥–Ω–æ—Ä—É–≤–∞—Ç–∏–º–µ—Ç—å—Å—è –∫–æ–ª–∏ USE_EXCHANGE_TP=False)


# ============================ ü§ñ SMART AVERAGING / DCA ============================
SMART_AVG = {
    "enabled": True,

    # —Ü—ñ –¥–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ç—É—Ç —Ä–∞–¥—à–µ –¥–æ–≤—ñ–¥–∫–æ–≤—ñ; —Ñ–∞–∫—Ç–∏—á–Ω—ñ –±–µ—Ä—É—Ç—å—Å—è –∑ MANUAL_* —è–∫—â–æ –ø—Ä–∞–ø–æ—Ä–∏ True
    "leverage": 5,
    "base_margin": 100.0,          # —Å—Ç–∞—Ä—Ç–æ–≤–∞ –º–∞—Ä–∂–∞ –Ω–∞ —É–≥–æ–¥—É (1-–∞ —Å—Ö–æ–¥–∏–Ω–∫–∞)

    "max_adds": 5,                 # –∫—ñ–ª—å–∫—ñ—Å—Ç—å –¥–æ–∫—É–ø–æ–∫ –º–∞–∫—Å–∏–º—É–º
    "dca_step_pct": 0.025,         # –∫—Ä–æ–∫ –º—ñ–∂ —Ä—ñ–≤–Ω—è–º–∏ (–≤—ñ–¥ —Å–µ—Ä–µ–¥–Ω—å–æ—ó), 4.5% ~ sweet spot –Ω–∞ 15m
    "dca_mode": "equal",           # "equal" –∞–±–æ "progressive"
    "dca_factor": 1.2,             # —è–∫—â–æ progressive ‚Äî –ø–æ–º—ñ—Ä–Ω–∏–π –º—É–ª—å—Ç–∏–ø–ª—ñ–∫–∞—Ç–æ—Ä

    # TP –≤—ñ–¥ —Å–µ—Ä–µ–¥–Ω—å–æ—ó —Ü—ñ–Ω–∏ (1% ‚âà +5% –¥–æ –¥–µ–ø–æ–∑–∏—Ç—É –ø—Ä–∏ 5√ó; 2% ‚âà +10%)
    "tp_from_avg_pct": 0.01,
    "alt_tp_from_avg_pct": 0.02,

    # –ª—ñ–º—ñ—Ç–∏/–≥–≤–∞—Ä–¥–∏
    "max_margin_per_trade": 600.0, # 100 —Å—Ç–∞—Ä—Ç + –¥–æ 5 –¥–æ–∫—É–ø–æ–∫ –ø–æ 100 = 600
    "min_liq_buffer": 0.40,        # –º—ñ–Ω. –±—É—Ñ–µ—Ä –¥–æ –ª—ñ–∫–≤—ñ–¥–∞—Ü—ñ—ó –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ—ó –¥–æ–∫—É–ø–∫–∏ (40%)
    "atr_pause_pct": 0.10,         # —è–∫—â–æ ATR%(15m) > 10% ‚Äî –ø–∞—É–∑–∞ –¥–æ–∫—É–ø–æ–∫
    "trend_flip_cut_pct": 0.40,    # –ø—Ä–∏ —Ñ–ª—ñ–ø—ñ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ç—Ä–µ–Ω–¥—É –ø—Ä–æ—Ç–∏ –Ω–∞—Å ‚Äî —Å–∫–æ—Ä–æ—á—É—î–º–æ 40%
    "cooldown_min": 20             # –ø–∞—É–∑–∞ –º—ñ–∂ –Ω–æ–≤–∏–º–∏ —Å–µ—Å—ñ—è–º–∏ —Ç–æ–≥–æ –∂ —Å–∏–º–≤–æ–ª—É
}

